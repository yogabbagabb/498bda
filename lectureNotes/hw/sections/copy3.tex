\documentclass[../main.tex]{subfiles}



%% Local Macros and packages: add any of your own definitions here.

\begin{document}

% Homework number, your name and NetID, and optionally, the names/NetIDs of anyone you collaborated with. If you did not collaborate with anybody, leave the last parameter empty.
\homework
    {0}
    {Aahan Agrawal (agrawl10)}
    {Some Person (sperson2), Another Person (aperson3)}

\section*{Problem (1)}
\textbf{Solution:} 

(a) \\
\begin{align*}
    \intertext{By definition of being $L$-smooth:} \\
    f(w_i) &\leq f(w_{i-1}) + \nabla f(w_{i-1})^T(w_{i} - w_{i-1}) + \frac{L}{2}\norm{w_{i} - w_{i-1}}^2 \\
    \intertext{Since $w_{i} - w_{i-1} = -\gamma \nabla f(w_{i-1})$} \\
    &= f(w_{i-1}) - \gamma \norm{\nabla f(w_{i-1})}^2 + \frac{L}{2}\norm{\gamma \nabla f(w_{i-1})}^2 \\ \\
    \intertext{Substituting in $\gamma = \frac{1}{L}$} \\
    &= f(w_{i-1}) - \frac{1}{L} \norm{\nabla f(w_{i-1})}^2 + \frac{L}{2L^2}\norm{ \nabla f(w_{i-1})}^2 \\
    &= f(w_{i-1}) - \frac{1}{L} \norm{\nabla f(w_{i-1})}^2 + \frac{1}{2L}\norm{ \nabla f(w_{i-1})}^2 \\
    &= f(w_{i-1}) - \frac{1}{2L} \norm{\nabla f(w_{i-1})}^2 \\
    \intertext{Now rearrange the inequality to obtain:} \\
    f(w_{i-1}) - f(w_{i}) &\geq \frac{1}{2L} \norm{\nabla f(w_{i-1})}^2 \\
    2L\left(f(w_{i-1}) - f(w_{i})\right) &\geq  \norm{\nabla f(w_{i-1})}^2 \\
    \sum_{i=1}^{T}\frac{2L\left(f(w_{i-1}) - f(w_{i})\right)}{T} &\geq  \sum_{i=1}^{T} \frac{\norm{\nabla f(w_{i-1})}^2}{T} \\
    \intertext{The LHS is telescoping sum, so it reduces to:} \\
    2\frac{f(w_0) - f(w_T)}{\gamma T}&\geq  \sum_{i=1}^{T} \frac{\norm{\nabla f(w_{i-1})}^2}{T} \\
\end{align*}

(b) \\

\begin{align*}
    \intertext{By definition of being $L$-smooth:} \\
    f(w_{i-1}) + \nabla f(w_{i-1})^T(w_{i} - w_{i-1}) + \frac{L}{2}\norm{w_{i} - w_{i-1}}^2 &\geq f(w_i) \\
    \intertext{Since $w_{i} - w_{i-1} = -\gamma g(w_{i-1})$} \\
    f(w_{i-1}) + \nabla f(w_{i-1})^T(-\gamma g(w_{i-1})) + \frac{L\gamma^2}{2}\norm{g(w_{i-1})}^2 &\geq f(w_i) \\
    \intertext{Rearranging the inequality:} \\
    \frac{L\gamma^2}{2}\norm{g(w_{i-1})}^2  - \nabla f(w_{i-1})^T(\gamma g(w_{i-1}))  &\geq f(w_i) - f(w_{i-1}) \\
    \gamma \left(\frac{L\gamma}{2}\norm{g(w_{i-1})}^2  - \nabla f(w_{i-1})^T g(w_{i-1})\right)  &\geq f(w_i) - f(w_{i-1}) \\
    \gamma \left( \left(\frac{1}{2}\right)\norm{\nabla f(w_{i-1}) - g(w_{i-1})}^2 + (\frac{L\gamma - 1}{2})\norm{g(w_{i-1})}^2)\right)  &\geq f(w_i) - f(w_{i-1}) + \frac{\gamma}{2}\norm{\nabla f(w_{i-1})}^2 \\
    \gamma \left( \left(\frac{1}{2}\right)\norm{\nabla f(w_{i-1}) - g(w_{i-1})}^2 + (\frac{L\gamma - 1}{2})\norm{g(w_{i-1})}^2)\right) - f(w_i) + f(w_{i-1}) &\geq\frac{\gamma}{2}\norm{\nabla f(w_{i-1})}^2 \\
    \intertext{Multiply out by $2$} \\
    \gamma \left( \norm{\nabla f(w_{i-1}) - g(w_{i-1})}^2 + (L\gamma - 1)\norm{g(w_{i-1})}^2)\right) - 2f(w_i) + 2f(w_{i-1}) &\geq \gamma\norm{\nabla f(w_{i-1})}^2 \\
    \intertext{Let us flip orientations to make this consistent with the proof statement.} \\
\end{align*}

\begin{align*}
    \gamma\norm{\nabla f(w_{i-1})}^2 &\leq \gamma \left( \norm{\nabla f(w_{i-1}) - g(w_{i-1})}^2 + (L\gamma - 1)\norm{g(w_{i-1})}^2)\right) - 2f(w_i) + 2f(w_{i-1})  \\
    \intertext{Let us divide by $\gamma$} \\
    \norm{\nabla f(w_{i-1})}^2 &\leq \norm{\nabla f(w_{i-1}) - g(w_{i-1})}^2 + (L\gamma - 1)\norm{g(w_{i-1})}^2 + \frac{-2f(w_i) + 2f(w_{i-1})}{\gamma}  \\
    \intertext{Setting $\gamma = \frac{1}{2L}$ and observing that $\norm{g(w_{i-1})^2} \geq 0$} \\
    \norm{\nabla f(w_{i-1})}^2 &\leq \norm{\nabla f(w_{i-1}) - g(w_{i-1})}^2 + (L\frac{1}{2L} - 1)\norm{g(w_{i-1})}^2 + \frac{-2f(w_i) + 2f(w_{i-1})}{\gamma}  \\
    \norm{\nabla f(w_{i-1})}^2 &\leq \norm{\nabla f(w_{i-1}) - g(w_{i-1})}^2 + \frac{-2f(w_i) + 2f(w_{i-1})}{\gamma}  \\
    \intertext{If we take the expectation, conditional on $w_{i-1}$, this gives} \\
    \bb{E}\norm{\nabla f(w_{i-1})}^2 &\leq \bb{E}\norm{\nabla f(w_{i-1}) - g(w_{i-1})}^2 + \frac{2\bb{E}\left(f(w_{i-1}) - f(w_{i})\right)}{\gamma}  \\
    \intertext{By hypothesis, we know that $\bb{E}\norm{\nabla f(w_{i-1}) - g(w_{i-1})}^2 \leq \sigma^2$, giving}\\
    \bb{E}\norm{\nabla f(w_{i-1})}^2 &\leq \sigma^2 + \frac{2\bb{E}\left(f(w_{i-1}) - f(w_{i})\right)}{\gamma}  \\
    \intertext{Taking the average, we then get:} \\
    \frac{1}{T}\sum_{i=1}^{T}\bb{E}\norm{\nabla f(w_{i-1})}^2 &\leq \sigma^2 + \frac{1}{T}\sum_{i=1}^{T}\frac{2\bb{E}\left(f(w_{i-1}) - f(w_{i})\right)}{\gamma}  \\
    \intertext{After distributing $\bb{E}$ on the RHS, and cancelling terms in the telescoping series:}
    \frac{1}{T}\sum_{i=1}^{T}\bb{E}\norm{\nabla f(w_{i-1})}^2 &\leq \sigma^2 + \frac{2\bb{E}\left(f(w_{0}) - f(w_{T})\right)}{\gamma T}  \\
\end{align*}

(c)\\

\begin{align*}
    \norm{w_{t+1} - w^{\star}}^2 &= \norm{(w_{t+1} - w_{t}) - (w^{\star} - w_{t})}^2 \\
    &= \norm{w_{t} - w^{\star}}^2 + \norm{w_{t+1} - w_{t}}^2 - 2(w_{t+1}-w_{t})^T(\star{w} - w_{t}) \\
    \intertext{Now substitute that $w_{t+1} - w_{t} = - \gamma g(w_{t})$} \\
    &= \norm{w_{t} - w^{\star}}^2 + \gamma^2\norm{g(w_t)}^2 - 2\gamma(g(w_t)^T)(w^{\star} - w_{t}) \\
    \intertext{Apply expectation, conditional on $w_t$} \\
    \bb{E} \norm{w_{t+1} - w^{\star}}^2 &= \bb{E}\left( \norm{w_{t} - w^{\star}}^2 \right) + \gamma^2 \bb{E}\left( \norm{g(w_t)}^2 \right) - 2 \bb{E}\gamma(g(w_t)^T)(w^{\star} - w_{t}) \\
    \intertext{Since $bb{E}g(w_t) = \nabla f(w_t)$ and $\bb{E}g(w^{\star}) = \nabla f(w^{\star}) = 0$, we have } \\
    \bb{E} \norm{w_{t+1} - w^{\star}}^2 &= \bb{E}\left( \norm{w_{t} - w^{\star}}^2 \right) + \gamma^2 \bb{E}\left( \norm{g(w_t)}^2 \right) - 2\gamma (\nabla f(w_t) - \nabla f(w^{\star}))^T(w^{\star} - w_{t}) \\
    \intertext{Since expectation is conditional on $w_t$} \\
    \bb{E} \norm{w_{t+1} - w^{\star}}^2 &= \left( \norm{w_{t} - w^{\star}}^2 \right) + \gamma^2 \bb{E}\left( \norm{g(w_t)}^2 \right) - 2\gamma (\nabla f(w_t) - \nabla f(w^{\star}))^T(w^{\star} - w_{t}) \\
\end{align*}

(d) \\

\begin{align*}
    \intertext{Applying the lemma to our case gives us:} \\
    \left[ \nabla f(w_{t}) - \nabla f(w^{\star}) \right]^T(w_{t} - w^{\star}) \geq \frac{\mu L}{\mu + L}\norm{w_{t} - w^{\star}}^2 + \frac{1}{\mu + L}\norm{\nabla f(w_{t}) - \nabla f(w^{\star})}^2 \\
    \intertext{Now let us substitute this inequality into the expression from part (c)} \\
    \bb{E} \norm{w_{t+1} - w^{\star}}^2 \leq \left( \norm{w_{t} - w^{\star}}^2 \right) + \gamma^2 \bb{E}\left( \norm{g(w_t)}^2 \right) - \frac{2 \mu L \gamma}{\mu + L}\norm{w_{t} - w^{\star}}^2 - \frac{2 \gamma}{\mu + L}\norm{\nabla f(w_{t}) - \nabla f(w^{\star})}^2 \\
    \bb{E} \norm{w_{t+1} - w^{\star}}^2 \leq (1 - \frac{2\mu L \gamma}{\mu + L})\left( \norm{w_{t} - w^{\star}}^2 \right) + \gamma^2 \bb{E}\left( \norm{g(w_t)}^2 \right) - \frac{2 \gamma}{\mu + L}\norm{\nabla f(w_{t}) - \nabla f(w^{\star})}^2 \\
    \intertext{Now let $\gamma = \frac{2}{\mu + L}$ }\\
    \bb{E} \norm{w_{t+1} - w^{\star}}^2 \leq (1 - \frac{4\mu L }{(\mu + L)^2})\left( \norm{w_{t} - w^{\star}}^2 \right) + \frac{4}{(\mu + L)^2} \bb{E}\left( \norm{g(w_t)}^2 \right) - \frac{4}{(\mu + L)^2}\norm{\nabla f(w_{t}) - \nabla f(w^{\star})}^2 \\
     = (1 - \frac{4\mu L }{(\mu + L)^2})\left( \norm{w_{t} - w^{\star}}^2 \right) + \frac{4}{(\mu + L)^2} \left(\bb{E}\left( \norm{g(w_t)}^2 \right) - \norm{\nabla f(w_{t}) - \nabla f(w^{\star})}^2\right) \\
     = (1 - \frac{4\mu L }{(\mu + L)^2})\left( \norm{w_{t} - w^{\star}}^2 \right) + \frac{4}{(\mu + L)^2} \left(\bb{E}\left( \norm{g(w_t)}^2 \right) - \norm{\nabla f(w_{t})}^2\right) \\
     = (1 - \frac{4\mu L }{(\mu + L)^2})\left( \norm{w_{t} - w^{\star}}^2 \right) + \frac{4}{(\mu + L)^2} \underbrace{\left(\bb{E}\left( \norm{g(w_t)}^2 \right) - \norm{\nabla f(w_{t})}^2\right)}_{\alpha} \\
     \intertext{We observe that $\alpha$ is the same as the expression} \\
     \bb{E} \norm{g(w_t) - \nabla f(w_t)}^2 \\
     \intertext{Since the foregoing expression expands to}
     \bb{E}\left( \norm{g(w_t)}^2 - 2g(w_t)^T\nabla f(w_t) + \norm{\nabla f(w_t)}^2 \right) \\
     = \bb{E}\left( \norm{g(w_t)}^2\right) - 2\bb{E}(g(w_t))^T\nabla f(w_t) + \bb{E}\norm{\nabla f(w_t)}^2  \\
     = \bb{E}\left( \norm{g(w_t)}^2\right) - 2\nabla f(w_t)^T\nabla f(w_t) + \norm{\nabla f(w_t)}^2  \\
     = \bb{E}\left( \norm{g(w_t)}^2\right) - 2\nabla f(w_t)^T\nabla f(w_t) + \norm{\nabla f(w_t)}^2  \\
     = \bb{E}\left( \norm{g(w_t)}^2\right) - \norm{\nabla f(w_t)}^2  \\
     \intertext{Thus, we have:} \\
     \bb{E} \norm{w_{t+1} - w^{\star}}^2 \leq (1 - \frac{4\mu L }{(\mu + L)^2})\left( \norm{w_{t} - w^{\star}}^2 \right) + \frac{4}{(\mu + L)^2}\bb{E}\left(\norm{g(w_t) - \nabla f(w_t)}^2\right)  \\
     \intertext{Now apply the hypothesis to get:} \\
     \leq (1 - \frac{4\mu L }{(\mu + L)^2})\left( \norm{w_{t} - w^{\star}}^2 \right) + \frac{4}{(\mu + L)^2}\sigma^2  \\
     \leq \underbrace{(1 - \frac{4\mu L }{(\mu + L)^2})}_{\beta}\left( \norm{w_{t} - w^{\star}}^2 \right) + \frac{4}{(\mu + L)^2}\sigma^2  \\
     \intertext{Observe that $\beta$ reduces to} \\
     \kappa = \frac{(\mu + L)^2 - 4\mu L }{(\mu + L)^2} = \frac{(\mu - L)^2 }{(\mu + L)^2} \in (0,1) \\
     \intertext{Subsituting $\kappa$ in:}
     \leq \kappa \left( \norm{w_{t} - w^{\star}}^2 \right) + \frac{4}{(\mu + L)^2}\sigma^2  \\
     \intertext{Thus, we have:} \\
     \bb{E} \norm{w_{t+1} - w^{\star}}^2 \leq \kappa \underbrace{\left( \norm{w_{t} - w^{\star}}^2 \right)}_{\ast} + \frac{4}{(\mu + L)^2}\sigma^2  \\
     \intertext{Note that an implicit expectation, conditional on $w_{t}$, acts on $\ast$} \\
     \bb{E} \norm{w_{t+1} - w^{\star}}^2 \leq \kappa \bb{E}\underbrace{\left( \norm{w_{t} - w^{\star}}^2 | w_{t} \right)}_{\ast} + \frac{4}{(\mu + L)^2}\sigma^2  \\
     \intertext{If we recurse on $\bb{E}\left(\norm{w_t - w^{\star}}^2\right)$ $T$ times, each time taking the expectation with respect to $w_{t-1}$, then we have}
     \bb{E} \norm{w_{t+1} - w^{\star}}^2 \leq \kappa^T \norm{w_{0} - w^{\star}}^2+ \mc{O}(\sigma^2)  \\
\end{align*}<++>



\newpage \nocite{*}
\bibliographystyle{ims}
\bibliography{citations}

\end{document}
